version: '3.7'

# starts 4 docker containers running minio server instances.
# using nginx reverse proxy, load balancing, you can access
# it through port 9000.
services:
  minio1:
      image: quay.io/minio/minio
      command: server --console-address ":9001"
      expose:
        - "9000"
        - "9001"
      environment:
       MINIO_ROOT_USER: root
       MINIO_ROOT_PASSWORD: password
      healthcheck:
        test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
        interval: 30s
        timeout: 20s
        retries: 3
      hostname: minio1
    volumes:
      - data1-1:/data1

  shared-library:
    image: shared-library
    hostname: shared-library
    environment:
      MINIO_PORT: 9000
      MINIO_ENDPOINT: 172.17.0.2
      MINIO_ACCESS_KEY: root
      MINIO_SECRET_KEY: password
      MINIO_BUCKET_NAME: bucket
    ports:
      - "4000:4000"
    depends_on:
      - minio1

## By default this config uses default local driver,
## For custom volumes replace with volume driver configuration.
volumes:
  data1-1:
